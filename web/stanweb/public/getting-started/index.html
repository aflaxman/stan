
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Getting Started with Rstan - Stan</title>
  <meta name="author" content="Stan Development Team">

  
  <meta name="description" content="RStan is the R interface for Stan. This howto includes how to install RStan, and how to use RStan. Prerequisites R Obviously we need R. In particular &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://mc-stan.org/getting-started/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Stan" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts (@embedded in css) -->

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Stan</a></h1>
  
    <h2>A C++ Library for Probability and Sampling</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:mc-stan.org" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog/archives">Topics</a></li>
  <li><a href="http://code.google.com/p/stan/">Google Code Page</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Getting Started With Rstan</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-24T12:50:00-04:00" pubdate data-updated="true">Aug 24<span>th</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>RStan is the <a href="http://R-project.org">R</a> interface for <a href="http://mc-stan.org">Stan</a>. This howto includes how to install RStan, and how to use RStan.</p>

<!-- more -->


<h2>Prerequisites</h2>

<h3>R</h3>

<p>Obviously we need <a href="http://R-project.org">R</a>. In particular, R version 2.15.1 is needed. This is because one package that RStan depends on
requires R 2.15.1.</p>

<h3>Other R packages</h3>

<p>As an R package, rstan depends directly on packages <a href="http://cran.r-project.org/web/packages/Rcpp/index.html">Rcpp</a>, <a href="http://cran.r-project.org/web/packages/RcppEigen/index.html">RcppEigen</a>, and <a href="http://cran.r-project.org/web/packages/inline/index.html">inline</a>.  So before installing rstan, these packages need to be installed:</p>

<figure class='code'><figcaption><span>Install Required Packages</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>install.packages<span class="p">(</span>c<span class="p">(</span><span class="s">&quot;inline&quot;</span><span class="p">,</span> <span class="s">&quot;Rcpp&quot;</span><span class="p">,</span> <span class="s">&quot;RcppEigen&quot;</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<h3>C++ compiler</h3>

<p>The same as Stan, RStan requires a C++ compiler that can be accessed by R. See Stan&#8217;s manual on how to install a C++ compiler on the platform of interest. In short, a C++ compiler for Mac/Windows/Linux can be obtained using the following information.</p>

<ul>
<li><strong>Mac OS X</strong> <a href="https://developer.apple.com/xcode/">Xcode</a> from Apple</li>
<li><strong>Windows</strong> GCC in <a href="http://cran.r-project.org/bin/windows/Rtools/">Rtools</a></li>
<li><strong>Linux</strong> GCC or Clang. Generally it is easy to use a package management tool in your Linux distribution such as <em>apt</em> on Debian (or Debian based) and <em>yum</em> on Fedora (or Fedora based). For example, use <code>apt-get install build-essential</code> on Debian.</li>
</ul>


<p>We can use the following R code to see if there is a C++ compiler that can be used by R.</p>

<figure class='code'><figcaption><span>using inline to compile C++ code on the fly</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>library<span class="p">(</span>inline<span class="p">)</span>
</span><span class='line'>library<span class="p">(</span>Rcpp<span class="p">)</span>
</span><span class='line'>src <span class="o">&lt;-</span> <span class="s">&#39; </span>
</span><span class='line'><span class="s">  std::vector&lt;std::string&gt; s; </span>
</span><span class='line'><span class="s">  s.push_back(&quot;hello&quot;);</span>
</span><span class='line'><span class="s">  s.push_back(&quot;world&quot;);</span>
</span><span class='line'><span class="s">  return Rcpp::wrap(s);</span>
</span><span class='line'><span class="s">&#39;</span>
</span><span class='line'>hellofun <span class="o">&lt;-</span> cxxfunction<span class="p">(</span>body <span class="o">=</span> src<span class="p">,</span> includes <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
</span><span class='line'>                        plugin <span class="o">=</span> <span class="s">&#39;Rcpp&#39;</span><span class="p">,</span> verbose <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
</span><span class='line'>cat<span class="p">(</span>hellofun<span class="p">(),</span> <span class="s">&#39;\n&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you run the above lines in R and you have C++, you&#8217;ll get <code>hello world</code> to appear in your R console.</p>

<h4>Modify C++ compiler optimization level</h4>

<p>This is optional. But changing the optimization level for compiling models can improve the speed of sampling.
We could change it as follows:</p>

<p>Run the following R code in R, to obtain the full path of file <code>Makeconf</code></p>

<figure class='code'><figcaption><span>Find the Makeconf that R uses</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>file.path<span class="p">(</span>R.home<span class="p">(</span>component <span class="o">=</span> <span class="s">&#39;etc&#39;</span><span class="p">),</span> <span class="m">.</span>Platform<span class="p">$</span>r_arch<span class="p">,</span> <span class="s">&#39;Makeconf&#39;</span><span class="p">)</span>
</span><span class='line'><span class="c1">## [1] &quot;/Library/Frameworks/R.framework/Resources/etc/x86_64/Makeconf&quot; ## on OS X</span>
</span><span class='line'><span class="c1">## [1] &quot;/usr/lib64/R/etc//Makeconf&quot; ## on Ubuntu</span>
</span></code></pre></td></tr></table></div></figure>


<p>Look for the line beginning with <code>CXXFLAGS</code> in file <em>Makeconf</em>, it might look like (it can be a little different depending on platforms)</p>

<figure class='code'><figcaption><span>Change this line in file you found above</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='make'><span class='line'><span class="nv">CXXFLAGS</span> <span class="o">=</span> -g -O2 <span class="k">$(</span>LTO<span class="k">)</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Change the above <code>-O2</code> to <code>-O3</code></p>

<h1>How to Install RStan</h1>

<p>Currently, RStan is not on <a href="http://cran.r-project.org/">CRAN</a>, a different <code>repos</code> for
<code>install.packages</code> can be used to install rstan.  That is, instead we call
<code>install.packages</code> to install rstan <em>from source</em>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'><span class="c1">## add current repository of rstan</span>
</span><span class='line'>options<span class="p">(</span>repos <span class="o">=</span> c<span class="p">(</span>getOption<span class="p">(</span><span class="s">&quot;repos&quot;</span><span class="p">),</span> rstan <span class="o">=</span> <span class="s">&quot;http://wiki.stan.googlecode.com/git/R&quot;</span><span class="p">))</span>
</span><span class='line'>install.packages<span class="p">(</span><span class="s">&#39;rstan&#39;</span><span class="p">,</span> type <span class="o">=</span> <span class="s">&#39;source&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Install using &#8216;contriburl&#8217; instead of &#8216;repos&#8217;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>install.packages<span class="p">(</span><span class="s">&#39;rstan&#39;</span><span class="p">,</span> contrib <span class="o">=</span> <span class="s">&#39;http://wiki.stan.googlecode.com/git/R/bin/macosx/leopard/contrib/2.15/&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>In addition, if the binary version of package rstan is not available, we can explicitly install the package from source as follows.</p>

<figure class='code'><figcaption><span>Set a package repository</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>options<span class="p">(</span>repos <span class="o">=</span> c<span class="p">(</span>getOption<span class="p">(</span><span class="s">&quot;repos&quot;</span><span class="p">),</span> rstan <span class="o">=</span> <span class="s">&quot;http://wiki.stan.googlecode.com/git/R&quot;</span><span class="p">))</span>
</span><span class='line'>install.packages<span class="p">(</span><span class="s">&#39;rstan&#39;</span><span class="p">,</span> type <span class="o">=</span> <span class="s">&#39;source&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h1>How to Use RStan</h1>

<h3>Load rstan</h3>

<p>The package names is <em>rstan</em>, so we need to use <code>library(rstan)</code> to load the package.</p>

<figure class='code'><figcaption><span>Load the rstan package</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>library<span class="p">(</span>rstan<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Example 1: The Eight Schools</h3>

<p>This is an example in Section 5.5 of Gelman <em>et al</em> (2003), which studied
coaching effects from eight schools. For simplicity, we call this exmaple
&#8220;eight schools.&#8221;</p>

<figure class='code'><figcaption><span>Eight Schools</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>schools.code <span class="o">&lt;-</span> <span class="s">&#39;</span>
</span><span class='line'><span class="s">  data {</span>
</span><span class='line'><span class="s">    int&lt;lower=0&gt; J; // number of schools </span>
</span><span class='line'><span class="s">    real y[J]; // estimated treatment effects</span>
</span><span class='line'><span class="s">    real&lt;lower=0&gt; sigma[J]; // s.e. of effect estimates </span>
</span><span class='line'><span class="s">  } </span>
</span><span class='line'><span class="s">  parameters {</span>
</span><span class='line'><span class="s">    real theta[J]; </span>
</span><span class='line'><span class="s">    real mu; </span>
</span><span class='line'><span class="s">    real&lt;lower=0&gt; tau; </span>
</span><span class='line'><span class="s">  } </span>
</span><span class='line'><span class="s">  model {</span>
</span><span class='line'><span class="s">    theta ~ normal(mu, tau); </span>
</span><span class='line'><span class="s">    y ~ normal(theta, sigma);</span>
</span><span class='line'><span class="s">  } </span>
</span><span class='line'><span class="s">&#39;</span>
</span><span class='line'>
</span><span class='line'>schools.dat <span class="o">&lt;-</span> list<span class="p">(</span>J <span class="o">=</span> <span class="m">8</span><span class="p">,</span>
</span><span class='line'>                    y <span class="o">=</span> c<span class="p">(</span><span class="m">28</span><span class="p">,</span>  <span class="m">8</span><span class="p">,</span> <span class="m">-3</span><span class="p">,</span>  <span class="m">7</span><span class="p">,</span> <span class="m">-1</span><span class="p">,</span>  <span class="m">1</span><span class="p">,</span> <span class="m">18</span><span class="p">,</span> <span class="m">12</span><span class="p">),</span>
</span><span class='line'>                    sigma <span class="o">=</span> c<span class="p">(</span><span class="m">15</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">16</span><span class="p">,</span> <span class="m">11</span><span class="p">,</span>  <span class="m">9</span><span class="p">,</span> <span class="m">11</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">18</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>fit <span class="o">&lt;-</span> stan<span class="p">(</span>model.code <span class="o">=</span> schools.code<span class="p">,</span> data <span class="o">=</span> schools.dat<span class="p">,</span>
</span><span class='line'>            n.iter <span class="o">=</span> <span class="m">1000</span><span class="p">,</span> n.chains <span class="o">=</span> <span class="m">4</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>In this example, we can also store the model&#8217;s Stan code
in a file, or we can download <a href="http://wiki.stan.googlecode.com/git/rstangettingstarted/8schools.stan">8schools.stan</a> (reproduced below) to our working
directory and use the following usage of function <code>stan</code> instead.</p>

<figure class='code'><figcaption><span>8schools.stan </span><a href='http://wiki.stan.googlecode.com/git/rstangettingstarted/8schools.stan'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='stan'><span class='line'><span class="kn">data</span> <span class="p">{</span>
</span><span class='line'>    <span class="kt">int</span><span class="err">&lt;</span><span class="n">lower</span><span class="err">=</span><span class="mi">0</span><span class="err">&gt;</span> <span class="n">J</span><span class="p">;</span> <span class="c1">// number of schools </span>
</span><span class='line'>    <span class="kt">real</span> <span class="n">y</span><span class="p">[</span><span class="n">J</span><span class="p">];</span> <span class="c1">// estimated treatment effects</span>
</span><span class='line'>    <span class="kt">real</span><span class="err">&lt;</span><span class="n">lower</span><span class="err">=</span><span class="mi">0</span><span class="err">&gt;</span> <span class="n">sigma</span><span class="p">[</span><span class="n">J</span><span class="p">];</span> <span class="c1">// s.e. of effect estimates </span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="kn">parameters</span> <span class="p">{</span>
</span><span class='line'>    <span class="kt">real</span> <span class="n">theta</span><span class="p">[</span><span class="n">J</span><span class="p">];</span>
</span><span class='line'>    <span class="kt">real</span> <span class="n">mu</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">real</span><span class="err">&lt;</span><span class="n">lower</span><span class="err">=</span><span class="mi">0</span><span class="err">&gt;</span> <span class="n">tau</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="kn">model</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">theta</span> <span class="o">~</span> <span class="nb">normal</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">tau</span><span class="p">);</span>
</span><span class='line'>    <span class="n">y</span> <span class="o">~</span> <span class="nb">normal</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">sigma</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>using an external file</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>fit1 <span class="o">&lt;-</span> stan<span class="p">(</span>file <span class="o">=</span> <span class="s">&#39;8schools.stan&#39;</span><span class="p">,</span> data <span class="o">=</span> schools.dat<span class="p">,</span>
</span><span class='line'>             n.iter <span class="o">=</span> <span class="m">1000</span><span class="p">,</span> n.chains <span class="o">=</span> <span class="m">4</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Once a model is fitted, we can use the fitted result as an input to
fit the model with other data or settings. This would save us time
of compiling the C++ code for the model. By specifying parameter
<code>fit</code> for function <code>stan</code>, we can fit the model again. For example,
if we want to sample more iterations, we can proceed as follows.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>fit2 <span class="o">&lt;-</span> stan<span class="p">(</span>fit <span class="o">=</span> fit1<span class="p">,</span> data <span class="o">=</span> schools.dat<span class="p">,</span> n.iter <span class="o">=</span> <span class="m">10000</span><span class="p">,</span> n.chains <span class="o">=</span> <span class="m">4</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>In addition, as in BUGS (or JAGS), Stan (different from RStan here) needs all the data to be in an R dump file. In the case we have this file, rstan provides function <code>read.rdump</code> to read all the data into an R list.  For example, we have a file named <em>8schools.rdump</em> that contains the following text in our working directory.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>J <span class="o">&lt;-</span> <span class="m">8</span>
</span><span class='line'>y <span class="o">&lt;-</span> c<span class="p">(</span><span class="m">28</span><span class="p">,</span>  <span class="m">8</span><span class="p">,</span> <span class="m">-3</span><span class="p">,</span>  <span class="m">7</span><span class="p">,</span> <span class="m">-1</span><span class="p">,</span>  <span class="m">1</span><span class="p">,</span> <span class="m">18</span><span class="p">,</span> <span class="m">12</span><span class="p">)</span>
</span><span class='line'>sigma_y <span class="o">&lt;-</span> c<span class="p">(</span><span class="m">15</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">16</span><span class="p">,</span> <span class="m">11</span><span class="p">,</span>  <span class="m">9</span><span class="p">,</span> <span class="m">11</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">18</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then we can read the data from &#8220;8schools.rdump&#8221; as follows.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>schools.dat <span class="o">&lt;-</span> read.rdump<span class="p">(</span><span class="s">&#39;8schools.rdump&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>The R dump file actually can be sourced using function <code>source</code> in R, which however by default would
read all the data into the global environment. In this case, we can specify the data for function <code>stan</code> using
object names. That is,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>source<span class="p">(</span><span class="s">&#39;8schools.rdump&#39;</span><span class="p">)</span>
</span><span class='line'>fit <span class="o">&lt;-</span> stan<span class="p">(</span>file <span class="o">=</span> <span class="s">&#39;8schools.stan&#39;</span><span class="p">,</span> data <span class="o">=</span> c<span class="p">(</span><span class="s">&quot;J&quot;</span><span class="p">,</span> <span class="s">&quot;y&quot;</span><span class="p">,</span> <span class="s">&quot;sigma_y&quot;</span><span class="p">),</span>
</span><span class='line'>            n.iter <span class="o">=</span> <span class="m">1000</span><span class="p">,</span> n.chains <span class="o">=</span> <span class="m">4</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Example 2: The Rats</h3>

<p>The Rats example is also a popular example. For example, we can find the <a href="http://www.openbugs.info">OpenBUGS</a> version <a href="http://www.openbugs.info/Examples/Rats.html">here</a>, which originally is from Gelfand <em>et al</em> (1990).
The data are about the growth of 30 rats weekly for five weeks.
In the linked data <a href="http://wiki.stan.googlecode.com/git/rstangettingstarted/rats.txt">rats.txt</a>, we list the data, in which we use <em>x</em> to denote the dates
the data were collected.</p>

<figure class='code'><figcaption><span>rats.stan  </span><a href='http://stan.googlecode.com/git/src/models/bugs_examples/vol1/rats/rats.stan'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class='stan'><span class='line'><span class="c1">// http://www.mrc-bsu.cam.ac.uk/bugs/winbugs/Vol1.pdf</span>
</span><span class='line'><span class="c1">// Page 3: Rats</span>
</span><span class='line'><span class="kn">data</span> <span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span><span class="err">&lt;</span><span class="n">lower</span><span class="err">=</span><span class="mi">0</span><span class="err">&gt;</span> <span class="n">N</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span><span class="err">&lt;</span><span class="n">lower</span><span class="err">=</span><span class="mi">0</span><span class="err">&gt;</span> <span class="kr">T</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">real</span> <span class="n">x</span><span class="p">[</span><span class="kr">T</span><span class="p">];</span>
</span><span class='line'>  <span class="kt">real</span> <span class="n">y</span><span class="p">[</span><span class="n">N</span><span class="p">,</span><span class="kr">T</span><span class="p">];</span>
</span><span class='line'>  <span class="kt">real</span> <span class="n">xbar</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="kn">parameters</span> <span class="p">{</span>
</span><span class='line'>  <span class="kt">real</span> <span class="n">alpha</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
</span><span class='line'>  <span class="kt">real</span> <span class="n">beta</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">real</span> <span class="n">mu_alpha</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">real</span> <span class="n">mu_beta</span><span class="p">;</span>          <span class="c1">// beta.c in original bugs model</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">real</span><span class="err">&lt;</span><span class="n">lower</span><span class="err">=</span><span class="mi">0</span><span class="err">&gt;</span> <span class="n">sigmasq_y</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">real</span><span class="err">&lt;</span><span class="n">lower</span><span class="err">=</span><span class="mi">0</span><span class="err">&gt;</span> <span class="n">sigmasq_alpha</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">real</span><span class="err">&lt;</span><span class="n">lower</span><span class="err">=</span><span class="mi">0</span><span class="err">&gt;</span> <span class="n">sigmasq_beta</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="kn">transformed parameters</span> <span class="p">{</span>
</span><span class='line'>  <span class="kt">real</span><span class="err">&lt;</span><span class="n">lower</span><span class="err">=</span><span class="mi">0</span><span class="err">&gt;</span> <span class="n">sigma_y</span><span class="p">;</span>       <span class="c1">// sigma in original bugs model</span>
</span><span class='line'>  <span class="kt">real</span><span class="err">&lt;</span><span class="n">lower</span><span class="err">=</span><span class="mi">0</span><span class="err">&gt;</span> <span class="n">sigma_alpha</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">real</span><span class="err">&lt;</span><span class="n">lower</span><span class="err">=</span><span class="mi">0</span><span class="err">&gt;</span> <span class="n">sigma_beta</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">sigma_y</span> <span class="o">&lt;-</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">sigmasq_y</span><span class="p">);</span>
</span><span class='line'>  <span class="n">sigma_alpha</span> <span class="o">&lt;-</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">sigmasq_alpha</span><span class="p">);</span>
</span><span class='line'>  <span class="n">sigma_beta</span> <span class="o">&lt;-</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">sigmasq_beta</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="kn">model</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">mu_alpha</span> <span class="o">~</span> <span class="nb">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
</span><span class='line'>  <span class="n">mu_beta</span> <span class="o">~</span> <span class="nb">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
</span><span class='line'>  <span class="n">sigmasq_y</span> <span class="o">~</span> <span class="nb">inv_gamma</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">);</span>
</span><span class='line'>  <span class="n">sigmasq_alpha</span> <span class="o">~</span> <span class="nb">inv_gamma</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">);</span>
</span><span class='line'>  <span class="n">sigmasq_beta</span> <span class="o">~</span> <span class="nb">inv_gamma</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">);</span>
</span><span class='line'>  <span class="n">alpha</span> <span class="o">~</span> <span class="nb">normal</span><span class="p">(</span><span class="n">mu_alpha</span><span class="p">,</span> <span class="n">sigma_alpha</span><span class="p">);</span> <span class="c1">// vectorized</span>
</span><span class='line'>  <span class="n">beta</span> <span class="o">~</span> <span class="nb">normal</span><span class="p">(</span><span class="n">mu_beta</span><span class="p">,</span> <span class="n">sigma_beta</span><span class="p">);</span>  <span class="c1">// vectorized</span>
</span><span class='line'>  <span class="kr">for</span> <span class="p">(</span><span class="n">n</span> <span class="kr">in</span> <span class="mi">1</span><span class="p">:</span><span class="n">N</span><span class="p">)</span>
</span><span class='line'>    <span class="kr">for</span> <span class="p">(</span><span class="n">t</span> <span class="kr">in</span> <span class="mi">1</span><span class="p">:</span><span class="kr">T</span><span class="p">)</span>
</span><span class='line'>      <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">~</span> <span class="nb">normal</span><span class="p">(</span><span class="n">alpha</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">beta</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">xbar</span><span class="p">),</span> <span class="n">sigma_y</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="kn">generated quantities</span> <span class="p">{</span>
</span><span class='line'>  <span class="kt">real</span> <span class="n">alpha0</span><span class="p">;</span>
</span><span class='line'>  <span class="n">alpha0</span> <span class="o">&lt;-</span> <span class="n">mu_alpha</span> <span class="o">-</span> <span class="n">xbar</span> <span class="o">*</span> <span class="n">mu_beta</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>R code to run the Rats model</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>library<span class="p">(</span>rstan<span class="p">)</span>
</span><span class='line'>y <span class="o">&lt;-</span> read.table<span class="p">(</span><span class="s">&#39;rats.txt&#39;</span><span class="p">,</span> header <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span><span class='line'>y <span class="o">&lt;-</span> data.matrix<span class="p">(</span>y<span class="p">)</span>
</span><span class='line'>x <span class="o">&lt;-</span> c<span class="p">(</span><span class="m">8</span><span class="p">,</span> <span class="m">15</span><span class="p">,</span> <span class="m">22</span><span class="p">,</span> <span class="m">29</span><span class="p">,</span> <span class="m">36</span><span class="p">)</span>
</span><span class='line'>rats.dat <span class="o">&lt;-</span> list<span class="p">(</span>N <span class="o">=</span> nrow<span class="p">(</span>y<span class="p">),</span> <span class="k-Variable">T</span> <span class="o">=</span> ncol<span class="p">(</span>y<span class="p">),</span>
</span><span class='line'>                 x <span class="o">=</span> x<span class="p">,</span> y <span class="o">=</span> y<span class="p">,</span> xbar <span class="o">=</span> mean<span class="p">(</span>x<span class="p">))</span>
</span><span class='line'>rats.fit <span class="o">&lt;-</span> stan<span class="p">(</span>file <span class="o">=</span> <span class="s">&#39;rats.stan&#39;</span><span class="p">,</span> data <span class="o">=</span> rats.dat<span class="p">,</span> verbose <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<h1>Need More Help?</h1>

<p>More details about RStan can be found in the documentation including the vignette of package rstan.
For example, using <code>help(stan)</code> and <code>help("stanfit-class")</code> to check out the help for function <code>stan</code>
and S4 class <code>stanfit</code>.<br/>
And see Stan&#8217;s manual for details about Stan and Stan modeling language.</p>

<h2>Reference</h2>

<ul>
<li>Gelman, A., Carlin, J. B., Stern, H. S., and Rubin, D. B. (2003). <em>Bayesian Data Analysis</em>, CRC Press, London, 2nd Edition.</li>
<li>The Stan Development Team (2012).  <a href="http://stan.googlecode.com/files/stan-reference.pdf">Stan Modeling Language: User&#8217;s Guide and Reference</a>.</li>
<li>Gelfand, A. E., Hills S. E., Racine-Poon, A., and Smith A. F. M. (1990). &#8220;Illustration of Bayesian Inference in Normal Data Models Using Gibbs Sampling&#8221;, Journal of the American Statistical Association, 85, 972-985.</li>
<li><a href="http://mc-stan.org">Stan</a></li>
<li><a href="http://R-project.org">R</a></li>
<li><a href="http://www.mrc-bsu.cam.ac.uk/bugs/">BUGS</a></li>
<li><a href="http://www.openbugs.info">OpenBUGS</a></li>
<li><a href="http://mcmc-jags.sourceforge.net/">JAGS</a></li>
<li><a href="http://cran.r-project.org/web/packages/Rcpp/index.html">Rcpp</a></li>
</ul>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Stan Development Team</span></span>

      








  


<time datetime="2012-08-24T12:50:00-04:00" pubdate data-updated="true">Aug 24<span>th</span>, 2012</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://mc-stan.org/getting-started/" data-via="" data-counturl="http://mc-stan.org/getting-started/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/command-line-quick-start/" title="Previous Post: Command-line Quick Start">&laquo; Command-line Quick Start</a>
      
      
        <a class="basic-alignment right" href="/download/" title="Next Post: Download">Download &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Sections</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/download/">Download</a>
      </li>
    
      <li class="post">
        <a href="/getting-started/">Getting Started with Rstan</a>
      </li>
    
      <li class="post">
        <a href="/command-line-quick-start/">Command-line Quick Start</a>
      </li>
    
      <li class="post">
        <a href="/c-plus-plus-quick-start/">C++ Quick Start</a>
      </li>
    
      <li class="post">
        <a href="/development-team/">Development Team</a>
      </li>
    
      <li class="post">
        <a href="/bug-reports-and-feature-requests/">Bug Reports &amp; Feature Requests</a>
      </li>
    
      <li class="post">
        <a href="/contribute/">Contribute Code & Models</a>
      </li>
    
      <li class="post">
        <a href="/bibtex-citations/">Bibtex Citations</a>
      </li>
    
      <li class="post">
        <a href="/mailing-lists/">Mailing Lists</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Acknowledgments</h1>
  <p>Stan was partially funded through two U. S. Department of Energy Grants (#527576, #522620). Stan is currently funded through a U. S. National Science Foundation grant (CNS-1205516) that runs through 2015.</p>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Stan Development Team -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
